"use strict";(self.webpackChunkvirtual_greenhouse_frontend=self.webpackChunkvirtual_greenhouse_frontend||[]).push([[217],{217:(e,s,a)=>{a.r(s),a.d(s,{default:()=>d});var l=a(43),r=a(216),i=a(475),n=a(621),o=a(579);const d=()=>{const[e,s]=(0,l.useState)(null),[a,d]=(0,l.useState)(!0),[c,t]=(0,l.useState)(!1),[m,h]=(0,l.useState)({name:"",email:"",phone:"",address:""}),[u,p]=(0,l.useState)([]),[v,x]=(0,l.useState)(null),j=((0,r.Zp)(),(0,l.useCallback)((async()=>{d(!0),x(null);try{const a=await n.Eo.getProfile();s(a.data),h({name:a.data.name||"",email:a.data.email||"",phone:a.data.phone||"",address:a.data.address||""});try{const e=await n.rX.getOrders();p(e.data)}catch(e){console.error("Error fetching orders:",e),p([])}}catch(v){console.error("Error fetching user data:",v),x("Failed to load profile data. Please try again.")}finally{d(!1)}}),[]));(0,l.useEffect)((()=>{j()}),[j]);const N=(0,l.useCallback)((e=>{const{name:s,value:a}=e.target;h((e=>({...e,[s]:a})))}),[]),f=(0,l.useCallback)((async e=>{e.preventDefault(),d(!0),x(null);try{const e=await n.Eo.updateProfile(m);s(e.data),t(!1),alert("Profile updated successfully!")}catch(v){var a,l,r,i;console.error("Error updating profile:",v),x((null===(a=v.response)||void 0===a||null===(l=a.data)||void 0===l?void 0:l.message)||"An error occurred while updating your profile"),alert((null===(r=v.response)||void 0===r||null===(i=r.data)||void 0===i?void 0:i.message)||"An error occurred while updating your profile")}finally{d(!1)}}),[m]),g=(0,l.useCallback)((()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("userType"),window.location.href="/login"}),[]),b=(0,l.useCallback)((()=>{t((e=>!e)),c&&e&&h({name:e.name||"",email:e.email||"",phone:e.phone||"",address:e.address||""})}),[c,e]);return a&&!e?(0,o.jsxs)("div",{className:"loading-spinner",children:[(0,o.jsx)("div",{className:"spinner"}),(0,o.jsx)("p",{children:"Loading profile..."})]}):v&&!e?(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)("h2",{children:"Error Loading Profile"}),(0,o.jsx)("p",{children:v}),(0,o.jsx)("button",{onClick:j,className:"retry-button",children:"Retry"})]}):a||e?(0,o.jsxs)("div",{className:"profile-page",children:[(0,o.jsxs)("header",{className:"profile-header",children:[(0,o.jsx)(i.N_,{to:"/user-dashboard",className:"logo",children:"VirtualGreen"}),(0,o.jsxs)("nav",{className:"profile-nav",children:[(0,o.jsx)(i.N_,{to:"/user-dashboard",children:"Home"}),(0,o.jsx)(i.N_,{to:"/shops",children:"Shops"}),(0,o.jsx)(i.N_,{to:"/cart",children:"Cart"}),(0,o.jsx)(i.N_,{to:"/profile",className:"active",children:"Profile"})]}),(0,o.jsx)("button",{className:"logout-btn",onClick:g,children:"Logout"})]}),(0,o.jsxs)("div",{className:"profile-container",children:[(0,o.jsxs)("div",{className:"profile-sidebar",children:[(0,o.jsxs)("div",{className:"profile-avatar",children:[(0,o.jsx)("img",{src:(null===e||void 0===e?void 0:e.avatarUrl)||"/assets/default-avatar.jpg",alt:"Profile"}),(0,o.jsx)("h2",{children:(null===e||void 0===e?void 0:e.name)||"User"}),(0,o.jsx)("p",{children:null===e||void 0===e?void 0:e.email})]}),(0,o.jsxs)("ul",{className:"profile-menu",children:[(0,o.jsx)("li",{className:"active",children:"Profile Information"}),(0,o.jsx)("li",{children:(0,o.jsx)(i.N_,{to:"/orders",children:"Order History"})})]})]}),(0,o.jsxs)("div",{className:"profile-content",children:[(0,o.jsxs)("div",{className:"profile-section",children:[(0,o.jsxs)("div",{className:"section-header",children:[(0,o.jsx)("h2",{children:"Profile Information"}),(0,o.jsx)("button",{className:"edit-btn",onClick:b,children:c?"Cancel":"Edit Profile"})]}),c?(0,o.jsxs)("form",{className:"profile-form",onSubmit:f,children:[v&&!a&&(0,o.jsx)("p",{className:"error-message",children:v}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"name",children:"Full Name"}),(0,o.jsx)("input",{type:"text",id:"name",name:"name",value:m.name,onChange:N,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"email",children:"Email"}),(0,o.jsx)("input",{type:"email",id:"email",name:"email",value:m.email,onChange:N,required:!0})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"phone",children:"Phone"}),(0,o.jsx)("input",{type:"tel",id:"phone",name:"phone",value:m.phone,onChange:N})]}),(0,o.jsxs)("div",{className:"form-group",children:[(0,o.jsx)("label",{htmlFor:"address",children:"Address"}),(0,o.jsx)("textarea",{id:"address",name:"address",value:m.address,onChange:N,rows:"3"})]}),(0,o.jsx)("button",{type:"submit",className:"save-btn",disabled:a,children:a?"Saving...":"Save Changes"})]}):(0,o.jsxs)("div",{className:"profile-info",children:[(0,o.jsxs)("div",{className:"info-group",children:[(0,o.jsx)("span",{className:"info-label",children:"Full Name:"}),(0,o.jsx)("span",{className:"info-value",children:(null===e||void 0===e?void 0:e.name)||"Not provided"})]}),(0,o.jsxs)("div",{className:"info-group",children:[(0,o.jsx)("span",{className:"info-label",children:"Email:"}),(0,o.jsx)("span",{className:"info-value",children:(null===e||void 0===e?void 0:e.email)||"Not provided"})]}),(0,o.jsxs)("div",{className:"info-group",children:[(0,o.jsx)("span",{className:"info-label",children:"Phone:"}),(0,o.jsx)("span",{className:"info-value",children:(null===e||void 0===e?void 0:e.phone)||"Not provided"})]}),(0,o.jsxs)("div",{className:"info-group",children:[(0,o.jsx)("span",{className:"info-label",children:"Address:"}),(0,o.jsx)("span",{className:"info-value",children:(null===e||void 0===e?void 0:e.address)||"Not provided"})]}),(0,o.jsxs)("div",{className:"info-group",children:[(0,o.jsx)("span",{className:"info-label",children:"Member Since:"}),(0,o.jsx)("span",{className:"info-value",children:null!==e&&void 0!==e&&e.createdAt?new Date(e.createdAt).toLocaleDateString():"Unknown"})]})]})]}),(0,o.jsxs)("div",{className:"profile-section",children:[(0,o.jsxs)("div",{className:"section-header",children:[(0,o.jsx)("h2",{children:"Recent Orders"}),(0,o.jsx)(i.N_,{to:"/orders",className:"view-all-link",children:"View All"})]}),(0,o.jsxs)("div",{className:"orders-list",children:[a&&(0,o.jsx)("p",{children:"Loading orders..."}),!a&&v&&(0,o.jsx)("p",{className:"error-message",children:v}),!a&&0===u.length&&!v&&(0,o.jsx)("p",{children:"You have no recent orders."}),u.length>0&&(0,o.jsx)("div",{className:"orders-list",children:u.slice(0,3).map((e=>(0,o.jsxs)("div",{className:"order-card",children:[(0,o.jsxs)("div",{className:"order-header",children:[(0,o.jsxs)(i.N_,{to:`/orders/${e._id}`,className:"order-id",children:["Order #",e._id.substring(0,8)]}),(0,o.jsx)("span",{className:"order-date",children:new Date(e.orderDate).toLocaleDateString()}),(0,o.jsx)("span",{className:`order-status ${e.status.toLowerCase().replace(/ /g,"-")}`,children:e.status})]}),(0,o.jsx)("div",{className:"order-items",children:e.items.map(((e,s)=>{var a,l,r;return(0,o.jsxs)("div",{className:"order-item",children:[(0,o.jsx)("img",{src:(null===(a=e.plant)||void 0===a?void 0:a.imageUrl)||e.image||"/assets/plant-placeholder.jpg",alt:(null===(l=e.plant)||void 0===l?void 0:l.name)||e.name}),(0,o.jsxs)("div",{className:"item-details",children:[(0,o.jsx)("span",{className:"item-name",children:(null===(r=e.plant)||void 0===r?void 0:r.name)||e.name}),(0,o.jsxs)("span",{className:"item-price",children:["\u20b9",(e.price*e.quantity).toFixed(2)," x ",e.quantity]})]})]},s)}))}),(0,o.jsxs)("div",{className:"order-footer",children:[(0,o.jsxs)("span",{className:"order-total",children:["Total: \u20b9",(e.totalAmount||0).toFixed(2)]}),(0,o.jsx)(i.N_,{to:`/orders/${e._id}`,className:"view-order-details",children:"View Details"})]})]},e._id)))})]})]})]})]})]}):(0,o.jsxs)("div",{className:"error-container",children:[(0,o.jsx)("h2",{children:"Profile Not Found"}),(0,o.jsx)("p",{children:"Could not load your profile information."}),(0,o.jsx)(i.N_,{to:"/user-dashboard",className:"retry-button",children:"Go to Dashboard"})]})}}}]);
//# sourceMappingURL=217.f5299840.chunk.js.map